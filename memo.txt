require 'webrick'
require 'webrick/https'
require 'openssl'

if opts[:webrick]
CRT_FILE_NAME = 'server.crt'
RSA_FILE_NAME = 'server.key'
 

unless File.exists?(CRT_FILE_NAME) || File.exists?(RSA_FILE_NAME)
  crt, rsa = WEBrick::Utils::create_self_signed_cert(1024, [["CN", WEBrick::Utils::getservername]], 'Generated by Ruby/OpenSSL')
  File.open(CRT_FILE_NAME, "w") {|f| f.write crt} 
  File.open(RSA_FILE_NAME, "w") {|f| f.write rsa}
end

webrick_options = {
       :Port               => 4443,
       :Logger             => WEBrick::Log::new("/dev/null"),
       AccessLog: [],
       :SSLEnable          => true,
       :SSLVerifyClient    => OpenSSL::SSL::VERIFY_NONE,
       :SSLCertificate     => OpenSSL::X509::Certificate.new(File.open(CRT_FILE_NAME).read),
       :SSLPrivateKey      => OpenSSL::PKey::RSA.new(File.open(RSA_FILE_NAME).read)
}

Rack::Handler::WEBrick.run WptrbWww, webrick_options do |server|
  shutdown_proc = ->( sig ){ server.shutdown() }
  [ :INT, :TERM ].each{ |e| Signal.trap( e, &shutdown_proc ) }  
end

end

proxy har page timings:
	browser.executeScript('
    	var performance = window.performance || {}; + 
		var timings = performance.timing || {};"+
		return timings;
	')
	browser.close
	  
	  
libpagespeed freebsd: 
	- make -C /usr/ports/www/mod_pagespeed
	- fetch https://dl-ssl.google.com/page-speed/sdk/current/page-speed-sdk.zip
	- unzip page-speed-sdk.zip ; cd page-speed-*
	- patch ./third_party/protobuf2/src/src/google/protobuf/stubs/common.h < /usr/ports/www/mod_pagespeed/files/patch-common.h
	- #portinstall -f graphics/optipng
	- gmake LDFLAGS="-L/usr/local/lib -L/usr/local/lib/libpng15/" CXXFLAGS="-I/usr/local/include"
	

libpagespeed osx :

	- wget https://dl-ssl.google.com/page-speed/sdk/current/page-speed-sdk.zip
	-  wget http://chromium.googlecode.com/issues/attachment?aid=8962634299372610520&name=ai_x86_macosx.h.diff&token=JheKr9jRXlgXOZ6CBFXH3GxhkRM%3A1361186365960
	- brew install libpng libjpg
	- patch 
	
	
pagespeed sort rez : 

	| perl -pe 's/.*(score=.*)\).*/$1/' | sed -e '/^ /d' | sort -u | sort -n